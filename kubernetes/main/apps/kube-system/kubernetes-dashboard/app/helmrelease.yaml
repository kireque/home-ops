
---
apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: kubernetes-dashboard
  namespace: kube-system

spec:
  interval: 5m
  chart:
    spec:
      chart: kubernetes-dashboard
      version: 7.1.2
      sourceRef:
        kind: HelmRepository
        name: kubernetes-dashboard
        namespace: flux-system
      interval: 10m

  install:
    timeout: 10m
    replace: true
    crds: CreateReplace
    createNamespace: true
    remediation:
      retries: 3

  upgrade:
    remediation:
      remediateLastFailure: true
      retries: 3
      strategy: rollback
    cleanupOnFail: true
    crds: CreateReplace

  test:
    enable: true

  rollback:
    recreate: true
    force: true
    cleanupOnFail: true

  uninstall:
    keepHistory: false
    
  maxHistory: 1

  values:

    app:
      image:
        pullPolicy: IfNotPresent
      
      ingress:
        enabled: true
        annotations:
          hajimari.io/enable: "true"
          hajimari.io/icon: logos:kubernetes
          hajimari.io/info: Kubernetes dashboard
          hajimari.io/group: admin
          nginx.ingress.kubernetes.io/proxy-body-size: "100m"
          nginx.ingress.kubernetes.io/configuration-snippet: |
            auth_request_set $required_groups 'kubernetes_dashboard';
        host:
          name: &host kubernetes.econline.nl
          path: "/"
        tls:
          - hosts:
              - *host
      protocolHttp: true

    # api:
    #   containers:
    #     args:
    #       - "--enable-skip-login"
    #       - "--disable-settings-authorizer"
    #       - "--enable-insecure-login"
    #       - "--token-ttl=43200"

    metricsScraper:
      enabled: false
    metrics-server:
      enabled: false

    cert-manager:
      enabled: false
      installCRDs: false

    nginx:
      enabled: false

    extras:
      serviceMonitor:
        enabled: true
